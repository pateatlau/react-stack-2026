#!/bin/bash

# Manual Testing Guide for GraphQL Frontend Integration

echo "========================================="
echo "GraphQL Frontend - Manual Testing Guide"
echo "========================================="
echo ""
echo "This guide walks you through testing the GraphQL integration manually."
echo ""

echo "Prerequisites:"
echo "-------------"
echo "1. Backend server running on http://localhost:4000"
echo "2. Frontend dev server running on http://localhost:5173"
echo ""

echo "Test Plan:"
echo "----------"
echo ""

echo "1. HOME PAGE NAVIGATION"
echo " URL: http://localhost:5173/"
echo " âœ“ Verify home page loads with two cards (REST & GraphQL)"
echo " âœ“ Click on 'GraphQL' card â†’ Should navigate to /graphql"
echo " âœ“ Click 'Back to Home' â†’ Should return to /"
echo " âœ“ Click on 'REST API' card â†’ Should navigate to /rest"
echo ""

echo "2. GRAPHQL PAGE - BASIC UI"
echo " URL: http://localhost:5173/graphql"
echo " âœ“ Verify page title shows 'Todo List (GraphQL)'"
echo " âœ“ Verify green subscription indicator shows 'Real-time updates active'"
echo " âœ“ Verify todo form is visible"
echo " âœ“ Verify todo list displays existing todos"
echo " âœ“ Verify filter tabs (All/Active/Completed)"
echo " âœ“ Verify statistics footer (Total/Active/Completed counts)"
echo ""

echo "3. CREATE TODO (GraphQL)"
echo " âœ“ Enter 'Test GraphQL Todo' in the title field"
echo " âœ“ Click 'Create Todo' button"
echo " âœ“ Verify optimistic update message appears"
echo " âœ“ Verify new todo appears at top of list instantly"
echo " âœ“ Verify form clears after creation"
echo ""

echo "4. TOGGLE TODO COMPLETION (GraphQL)"
echo " âœ“ Click checkbox on any todo"
echo " âœ“ Verify todo title gets strikethrough instantly (optimistic)"
echo " âœ“ Verify completed count updates in statistics"
echo " âœ“ Click checkbox again to un-complete"
echo " âœ“ Verify strikethrough removed instantly"
echo ""

echo "5. EDIT TODO (GraphQL)"
echo " âœ“ Click 'Edit' button on any todo"
echo " âœ“ Verify form populates with todo data"
echo " âœ“ Change title to 'Updated GraphQL Todo'"
echo " âœ“ Click 'Update Todo' button"
echo " âœ“ Verify todo updates instantly"
echo " âœ“ Verify 'Updated:' timestamp changes"
echo ""

echo "6. DELETE TODO (GraphQL)"
echo " âœ“ Click 'Delete' button on any todo"
echo " âœ“ Verify todo disappears instantly (optimistic)"
echo " âœ“ Verify total count decreases"
echo " âœ“ Verify statistics update"
echo ""

echo "7. FILTERING (GraphQL)"
echo " âœ“ Click 'Active' tab â†’ Verify only incomplete todos shown"
echo " âœ“ Click 'Completed' tab â†’ Verify only completed todos shown"
echo " âœ“ Click 'All' tab â†’ Verify all todos shown"
echo " âœ“ Verify pagination resets to page 1 when changing filters"
echo ""

echo "8. PAGINATION (GraphQL)"
echo " (If you have more than 10 todos)"
echo " âœ“ Verify pagination controls appear at bottom"
echo " âœ“ Click 'Next' button â†’ Verify page 2 loads"
echo " âœ“ Verify page indicator shows 'Page 2 of X'"
echo " âœ“ Click 'Previous' button â†’ Verify returns to page 1"
echo " âœ“ Verify 'Previous' button disabled on page 1"
echo " âœ“ Verify 'Next' button disabled on last page"
echo ""

echo "9. REAL-TIME SUBSCRIPTIONS (GraphQL)"
echo " âœ“ Open http://localhost:5173/graphql in TWO browser tabs"
echo " âœ“ In Tab 1: Create a new todo"
echo " âœ“ In Tab 2: Verify todo appears automatically (within 1-2 seconds)"
echo " âœ“ In Tab 1: Toggle a todo completion"
echo " âœ“ In Tab 2: Verify completion status updates automatically"
echo " âœ“ In Tab 1: Delete a todo"
echo " âœ“ In Tab 2: Verify todo disappears automatically"
echo ""

echo "10. ERROR HANDLING (GraphQL)"
echo " âœ“ Try to create todo with empty title"
echo " âœ“ Verify validation error appears: 'Title is required'"
echo " âœ“ Try to create very long title (>200 chars)"
echo " âœ“ Verify error: 'Title must be less than 200 characters'"
echo ""

echo "11. COMPARE REST vs GRAPHQL"
echo " âœ“ Open http://localhost:5173/rest"
echo " âœ“ Create/update/delete todos on REST page"
echo " âœ“ Note: REST page does NOT have real-time updates"
echo " âœ“ Note: REST page requires manual refresh to see changes"
echo " âœ“ Switch back to /graphql"
echo " âœ“ Note: GraphQL page has real-time subscription indicator"
echo " âœ“ Note: GraphQL page shows instant optimistic updates"
echo ""

echo "12. PERFORMANCE CHECKS"
echo " âœ“ Open browser DevTools (F12)"
echo " âœ“ Go to Network tab"
echo " âœ“ Filter by 'WS' (WebSocket)"
echo " âœ“ Verify WebSocket connection to ws://localhost:4000/graphql"
echo " âœ“ Create a todo â†’ Verify only ONE GraphQL mutation request"
echo " âœ“ Verify optimistic response (UI updates before server responds)"
echo " âœ“ Go to Application tab â†’ Storage â†’ Cache Storage"
echo " âœ“ Verify Apollo Client cache is populated"
echo ""

echo "========================================="
echo "Expected Results Summary"
echo "========================================="
echo ""
echo "âœ“ All CRUD operations work instantly (optimistic updates)"
echo "âœ“ Real-time subscriptions sync data across browser tabs"
echo "âœ“ Filtering and pagination work correctly"
echo "âœ“ Error messages are user-friendly"
echo "âœ“ Loading states show appropriate spinners"
echo "âœ“ Statistics update in real-time"
echo "âœ“ Navigation between routes works smoothly"
echo "âœ“ WebSocket connection established and stable"
echo ""

echo "Known Limitations:"
echo "-----------------"
echo "â€¢ Backend has rate limiting (10 requests per 10 seconds)"
echo "â€¢ If you get 'Rate limit exceeded', wait 10 seconds"
echo "â€¢ Node.js version warning can be ignored (app still works)"
echo ""

echo "Testing Complete! ðŸŽ‰"
echo ""
echo "To test subscriptions programmatically, you can run:"
echo " wscat -c ws://localhost:4000/graphql -s graphql-ws"
echo ""
